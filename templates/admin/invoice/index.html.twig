{% extends 'admin/admin_base.html.twig' %}

{% block title %}Facturation{% endblock %}

{% block pageTitle %}Confirmation des données et facturation{% endblock %}

{% block content %}
    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6">
                    <div class="alert alert-info">
                        <span>
                            Veuillez vérifier les données de facturation ci-dessous avant de cliquer sur le bouton de confirmation.<br>
                            Après confirmation, la facture sera envoyée automatiquement à l'adresse e-mail mentionnée.
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
                        {{ form_row(form._token) }}
                        <form id="invoiceConfirmationForm" action="" method="post">
                            <div class="card-content">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.firstName) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Prénom<star>*</star>
                                            </label>
                                            {{ form_row(form.firstName) }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.lastName) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Nom<star>*</star>
                                            </label>
                                            {{ form_row(form.lastName) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.firstName) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Société
                                            </label>
                                            {{ form_row(form.company) }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.lastName) %}has-error{% endif %}">
                                            <label class="control-label">
                                                TVA
                                            </label>
                                            {{ form_row(form.tva) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.email) %}has-error{% endif %}">
                                            <label class="control-label">
                                                E-Mail<star>*</star>
                                            </label>
                                            {{ form_row(form.email) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.address) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Rue + N°<star>*</star>
                                            </label>
                                            {{ form_row(form.address) }}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group {% if form_errors(form.postalCode) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Code Postal<star>*</star>
                                            </label>
                                            {{ form_row(form.postalCode) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.city) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Ville<star>*</star>
                                            </label>
                                            {{ form_row(form.city) }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group {% if form_errors(form.city) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Pays<star>*</star>
                                            </label>
                                            {{ form_row(form.country) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group {% if form_errors(form.phone) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Téléphone<star>*</star>
                                            </label>
                                            {{ form_row(form.phone) }}
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="form-group {% if form_errors(form.event) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Formation<star>*</star>
                                            </label>
                                            {{ form_row(form.event) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group {% if form_errors(form.price) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Prix TTC<star>*</star>
                                            </label>
                                            {{ form_row(form.price) }}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group {% if form_errors(form.tvaRate) %}has-error{% endif %}">
                                            <label class="control-label">
                                                % TVA<star>*</star>
                                            </label>
                                            {{ form_row(form.tvaRate) }}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group {% if form_errors(form.totalHTVA) %}has-error{% endif %}">
                                            <label class="control-label">
                                                Prix HTVA<star>*</star>
                                            </label>
                                            {{ form_row(form.totalHTVA) }}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group {% if form_errors(form.totalTVA) %}has-error{% endif %}">
                                            <label class="control-label">
                                                € TVA<star>*</star>
                                            </label>
                                            {{ form_row(form.totalTVA) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="category"><star>*</star> Champs obligatoires</div>
                                <div class="card-footer">
                                    <a class="btn btn-danger btn-fill pull-right" href="{{ path('event_registration_index') }}" style="margin-left: 1rem;">Annuler</a>
                                    <button class="btn btn-info btn-fill pull-right">Confirmer et facturer</button>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </form>
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {
            //this calculates values automatically
            calculate();
            $("#confirm_registration_price, #confirm_registration_tvaRate").on("keydown keyup", function() {
                calculate();
            });
        });

        function calculate() {
            var price = document.getElementById("confirm_registration_price").value
            var tvaRate = document.getElementById("confirm_registration_tvaRate").value
            var tva = price * (tvaRate/100)
            var priceHTVA = price - tva

            if (!isNaN(tva)) {
                document.getElementById('confirm_registration_totalTVA').value = tva;
                document.getElementById('confirm_registration_totalHTVA').value = priceHTVA;
            }
        }
    </script>
{% endblock %}
